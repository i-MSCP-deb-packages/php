Description: fix more missing file path null byte checks
Origin: backport, http://git.php.net/?p=php-src.git;a=commit;h=f7d7befae8bcc2db0093f8adaa9f72eeb7ad891e
Bug: https://bugs.php.net/bug.php?id=69719

---
 ext/dom/document.c |   22 ++++++++++++++++++++++
 ext/gd/gd.c        |    5 +++++
 2 files changed, 27 insertions(+)

--- a/ext/dom/document.c
+++ b/ext/dom/document.c
@@ -1762,6 +1762,11 @@ PHP_FUNCTION(dom_document_save)
 		RETURN_FALSE;
 	}
 
+	/* No nulls allowed in paths */
+	if (strlen(file) != file_len) {
+		RETURN_FALSE;
+	}
+
 	DOM_GET_OBJ(docp, id, xmlDocPtr, intern);
 
 	/* encoding handled by property on doc */
@@ -1995,6 +2000,10 @@ static void _dom_document_schema_validat
 
 	switch (type) {
 	case DOM_LOAD_FILE:
+		if (CHECK_NULL_PATH(source, source_len)) {
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid Schema file source");
+			RETURN_FALSE;
+		}
 		valid_file = _dom_get_valid_file_path(source, resolved_path, MAXPATHLEN  TSRMLS_CC);
 		if (!valid_file) {
 			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid Schema file source");
@@ -2084,6 +2093,10 @@ static void _dom_document_relaxNG_valida
 
 	switch (type) {
 	case DOM_LOAD_FILE:
+		if (CHECK_NULL_PATH(source, source_len)) {
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid RelaxNG file source");
+			RETURN_FALSE;
+		}
 		valid_file = _dom_get_valid_file_path(source, resolved_path, MAXPATHLEN  TSRMLS_CC);
 		if (!valid_file) {
 			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid RelaxNG file source");
@@ -2173,6 +2186,10 @@ static void dom_load_html(INTERNAL_FUNCT
 	}
 
 	if (mode == DOM_LOAD_FILE) {
+		if (CHECK_NULL_PATH(source, source_len)) {
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid file source");
+			RETURN_FALSE;
+		}
 		ctxt = htmlCreateFileParserCtxt(source, NULL);
 	} else {
 		source_len = xmlStrlen(source);
@@ -2266,6 +2283,11 @@ PHP_FUNCTION(dom_document_save_html_file
 		RETURN_FALSE;
 	}
 
+	/* No nulls allowed in paths */
+	if (strlen(file) != file_len) {
+		RETURN_FALSE;
+	}
+
 	DOM_GET_OBJ(docp, id, xmlDocPtr, intern);
 
 
--- a/ext/gd/gd.c
+++ b/ext/gd/gd.c
@@ -4049,6 +4049,11 @@ PHP_FUNCTION(imagepsloadfont)
 		return;
 	}
 
+	/* No nulls allowed in paths */
+	if (strlen(file) != file_len) {
+		RETURN_FALSE;
+	}
+
 #ifdef PHP_WIN32
 	if (VCWD_STAT(file, &st) < 0) {
 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Font file not found (%s)", file);
