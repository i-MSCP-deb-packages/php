Backport of:

From 7903276f4c18fcfda06c02785f0b4201421f9c7c Mon Sep 17 00:00:00 2001
From: Xinchen Hui <laruence@gmail.com>
Date: Tue, 12 Jul 2016 12:14:45 +0800
Subject: [PATCH] backport to 5.6 (we should not unset the default value)

---
 Zend/zend_exceptions.c                     |    2 +-
 ext/standard/tests/serialize/bug69152.phpt |    1 -
 ext/standard/tests/serialize/bug69793.phpt |    2 --
 3 files changed, 1 insertion(+), 4 deletions(-)

--- a/Zend/zend_exceptions.c
+++ b/Zend/zend_exceptions.c
@@ -209,7 +209,7 @@ ZEND_METHOD(exception, __construct)
    Exception unserialize checks */
 #define CHECK_EXC_TYPE(name, type) \
 	value = zend_read_property(default_exception_ce, object, name, sizeof(name)-1, 0 TSRMLS_CC); \
-	if(value && Z_TYPE_P(value) != type) { \
+	if (value && Z_TYPE_P(value) != IS_NULL && Z_TYPE_P(value) != type) { \
 		zval *tmp; \
 		MAKE_STD_ZVAL(tmp); \
 		ZVAL_STRINGL(tmp, name, sizeof(name)-1, 1); \
--- a/ext/standard/tests/serialize/bug69152.phpt
+++ b/ext/standard/tests/serialize/bug69152.phpt
@@ -9,7 +9,6 @@ $x->test();
 
 ?>
 --EXPECTF--
-Notice: Undefined property: Exception::$previous in %s on line %d
 exception 'Exception' in %s:%d
 Stack trace:
 #0 {main}
--- a/ext/standard/tests/serialize/bug69793.phpt
+++ b/ext/standard/tests/serialize/bug69793.phpt
@@ -7,8 +7,6 @@ $e = unserialize('O:9:"Exception":7:{s:1
 var_dump($e."");
 ?>
 --EXPECTF--
-Notice: Undefined property: Exception::$message in %s/bug69793.php on line %d
-
 Notice: Undefined property: Exception::$file in %s/bug69793.php on line %d
 
 Notice: Undefined property: Exception::$previous in %s/bug69793.php on line %d
