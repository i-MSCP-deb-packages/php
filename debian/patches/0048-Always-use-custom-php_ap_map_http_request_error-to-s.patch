From: =?utf-8?q?Ond=C5=99ej_Sur=C3=BD?= <ondrej@sury.org>
Date: Wed, 15 Mar 2017 10:13:03 +0100
Subject: Always use custom php_ap_map_http_request_error to support older
 apache2 at the runtime

---
 sapi/apache2handler/sapi_apache2.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/sapi/apache2handler/sapi_apache2.c b/sapi/apache2handler/sapi_apache2.c
index 36b9a82..809dd03 100644
--- a/sapi/apache2handler/sapi_apache2.c
+++ b/sapi/apache2handler/sapi_apache2.c
@@ -64,10 +64,12 @@
 #define PHP_SCRIPT "php7-script"
 
 /* if apache's version is newer than 2.2.31 or 2.4.16 */
-#if MODULE_MAGIC_COOKIE == 0x41503232UL && AP_MODULE_MAGIC_AT_LEAST(20051115,40) || \
+/* Support running with older apache2 binaries */
+/* #if MODULE_MAGIC_COOKIE == 0x41503232UL && AP_MODULE_MAGIC_AT_LEAST(20051115,40) || \
 	MODULE_MAGIC_COOKIE == 0x41503234UL && AP_MODULE_MAGIC_AT_LEAST(20120211,47)
 #define php_ap_map_http_request_error ap_map_http_request_error
 #else
+*/
 static int php_ap_map_http_request_error(apr_status_t rv, int status)
 {
 	switch (rv) {
@@ -88,7 +90,7 @@ static int php_ap_map_http_request_error(apr_status_t rv, int status)
 	}
 	}
 }
-#endif
+/* #endif */
 
 /* A way to specify the location of the php.ini dir in an apache directive */
 char *apache2_php_ini_path_override = NULL;
