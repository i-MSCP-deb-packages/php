From 1cda0d7c2ffb62d8331c64e703131d9cabdc03ea Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Sat, 31 Dec 2016 19:31:49 -0800
Subject: [PATCH] Fix bug #73737 FPE when parsing a tag format

---
 ext/exif/exif.c              |   2 +-
 ext/exif/tests/bug73737.phpt |  12 ++++++++++++
 ext/exif/tests/bug73737.tiff | Bin 0 -> 48 bytes
 ext/exif/exif.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
 create mode 100644 ext/exif/tests/bug73737.phpt
 create mode 100644 ext/exif/tests/bug73737.tiff

--- a/ext/exif/exif.c
+++ b/ext/exif/exif.c
@@ -1313,7 +1313,7 @@ static size_t exif_convert_any_to_int(vo
 			if (s_den == 0) {
 				return 0;
 			} else {
-				return php_ifd_get32s(value, motorola_intel) / s_den;
+				return (size_t)((double)php_ifd_get32s(value, motorola_intel) / s_den);
 			}
 
 		case TAG_FMT_SSHORT:    return php_ifd_get16u(value, motorola_intel);
