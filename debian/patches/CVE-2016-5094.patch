Backport of:

From 0da8b8b801f9276359262f1ef8274c7812d3dfda Mon Sep 17 00:00:00 2001
From: Stanislav Malyshev <stas@php.net>
Date: Sun, 15 May 2016 23:26:51 -0700
Subject: [PATCH] Fix bug #72135 - don't create strings with lengths outside
 int range

---
 ext/standard/html.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/ext/standard/html.c
+++ b/ext/standard/html.c
@@ -1288,6 +1288,10 @@ static void php_html_entities(INTERNAL_F
 	}
 
 	replaced = php_escape_html_entities_ex(str, str_len, &len, all, quote_style, hint_charset, double_encode TSRMLS_CC);
+	if (len > INT_MAX) {
+		efree(replaced);
+		RETURN_FALSE;
+	}
 	RETVAL_STRINGL(replaced, len, 0);
 }
 /* }}} */
